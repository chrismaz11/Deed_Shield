import { buildServer } from './src/server.js';
let appPromise = null;
async function getApp() {
    if (!appPromise) {
        appPromise = buildServer({
            attomApiKey: process.env.ATTOM_API_KEY || '',
            attomBaseUrl: process.env.ATTOM_BASE_URL || 'https://api.gateway.attomdata.com',
            rpcUrl: process.env.RPC_URL || '',
            registryAddress: process.env.REGISTRY_ADDRESS || '',
            openaiApiKey: process.env.OPENAI_API_KEY,
            rateLimitMax: Number(process.env.RATE_LIMIT_MAX || 100),
            rateLimitWindow: process.env.RATE_LIMIT_WINDOW || '1 minute'
        });
    }
    const app = await appPromise;
    await app.ready();
    return app;
}
export default async function handler(req, res) {
    const app = await getApp();
    app.server.emit('request', req, res);
}
